<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Exemplo com Conversão de WhatsApp</title>

  <!-- Global site tag (gtag.js) - Google Ads + GA4 (opcional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-620453322"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    /* Google Ads */
    gtag('config', 'AW-620453322');

    /* GA4 (se você usa esse ID no seu site, mantenha; senão, remova) */
    gtag('config', 'G-7961MTK7HWL');
  </script>
  
  <style>
    body {font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; margin: 40px; line-height: 1.5;}
    .cta{display:inline-block; background:#25D366; color:#fff; padding:12px 18px; border-radius:8px; text-decoration:none; font-weight:600}
    .cta:hover{filter:brightness(0.95)}
    .box{border:1px solid #e5e5e5; padding:18px; border-radius:10px; margin-top:20px}
    code {background:#f6f8fa; padding:2px 6px; border-radius:6px}
  </style>
</head>
<body>
  <h1>Exemplo – Conversão de Clique no WhatsApp (Google Ads)</h1>
  <p>Este arquivo contém a base correta do gtag e um <em>handler</em> que dispara a conversão ao clicar
  em qualquer link do site que aponte para o WhatsApp.</p>

  <div class="box">
    <p>Botão de teste:</p>
    <a class="cta" href="https://wa.me/5599000000000?text=Oi%20quero%20atendimento" target="_blank" rel="noopener">Falar no WhatsApp</a>
  </div>

  <!-- Conversão: Clique no WhatsApp – Site  -->
  <script>
  (function() {
    var SENT = false;
    function isWhatsAppLink(el) {
      if (!el || !el.href) return false;
      return /(wa\.me|whatsapp\.com|whatsapp:\/\/send)/i.test(el.href);
    }
    function sendConv(){
      if (SENT) return;
      SENT = true;
      gtag('event','conversion',{
        'send_to': 'AW-620453322/yJl8CJOUwIkbEMq77acC'
      });
      /* Libera novamente após 1s para evitar múltiplos envios no mesmo clique */
      setTimeout(function(){ SENT=false; }, 1000);
    }
    /* Captura cliques em qualquer link que abra WhatsApp (delegação) */
    document.addEventListener('click', function(e){
      var el = e.target;
      while(el && el !== document) {
        if (el.tagName === 'A' && isWhatsAppLink(el)) {
          sendConv();
          return;
        }
        el = el.parentElement;
      }
    }, true);

    /* Gatilho opcional para uso manual:
       window.dispatchEvent(new Event('gtm.whatsapp')); */
    window.addEventListener('gtm.whatsapp', sendConv);
  })();
  </script>

  <p class="box">
    <strong>Como usar no seu site:</strong><br>
    1) Copie apenas os dois blocos &lt;script&gt; deste arquivo: o <em>gtag base</em> no &lt;head&gt; e o
    <em>handler</em> de conversão logo antes de &lt;/body&gt;.<br>
    2) Não mantenha nenhum outro snippet antigo de conversão para WhatsApp (evita duplicidade).<br>
    3) Publique, recarregue o site e clique no botão de WhatsApp. No Tag Assistant você verá
    “Clique no WhatsApp – Site” como <em>evento de conversão</em> enviado.
  </p>
</body>
</html>
